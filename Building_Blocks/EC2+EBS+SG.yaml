Parameters:
  InstanceTypeParameter:
    Type: String
    Default: t2.micro
    AllowedValues:
      - t2.micro
      - t2.small
      - t2.nano
    Description: Enter t2.micro, t2.small, or t2.nano. Default is t2.micro.

  InstanceAzParameter:
    Type: AWS::EC2::AvailabilityZone::Name
    Default: us-east-1a
    Description: Select an availability zone

  DiskSizeParameter:
    Type: Number
    Default: 20
    Description: Insert the disk size

Resources:
  MyInstance:
    Type: AWS::EC2::Instance
    Properties:
      AvailabilityZone: !Ref InstanceAzParameter
      ImageId: ami-a4c7edb2
      InstanceType: !Ref InstanceTypeParameter
      SecurityGroups: [!Ref SSHSecurityGroup]
      Volumes:
        - Device: "/dev/sdn"
          VolumeId: !Ref Disk1
        - Device: "/dev/sdm"
          VolumeId: !Ref Disk2
        - Device: "/dev/sdo"
          VolumeId: !Ref Disk3

  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: SSH-SecurityGroup
      GroupDescription: Enable port 22
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: 0.0.0.0/0

# Disks can be attached and deattached on fly
  Disk1:
    Type: AWS::EC2::Volume
    Properties:
      Size: !Ref DiskSizeParameter
      AvailabilityZone: !Ref InstanceAzParameter
    DeletionPolicy: Snapshot

  Disk2:
   Type: AWS::EC2::Volume
   Properties:
     Size: !Ref DiskSizeParameter
     AvailabilityZone: !Ref InstanceAzParameter
   DeletionPolicy: Snapshot

  Disk3:
   Type: AWS::EC2::Volume
   Properties:
     Size: !Ref DiskSizeParameter
     AvailabilityZone: !Ref InstanceAzParameter
   DeletionPolicy: Snapshot

Outputs:
  PublicIp:
    Description: Public IP address of the newly created EC2 instance
    Value: !GetAtt MyInstance.PublicIp

  InstanceId:
    Description: InstanceId of the EC2 instance
    Value: !Ref MyInstance